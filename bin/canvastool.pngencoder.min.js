/** @license CanvasTool.PngEncoder 2012 - imaya [ https://github.com/imaya/CanvasTool.PngEncoder ] The MIT License */
(function() {'use strict';function n(b){throw b;}var v=void 0,w=!0,z,aa=this;function B(b,a){var c=b.split("."),e=aa;!(c[0]in e)&&e.execScript&&e.execScript("var "+c[0]);for(var d;c.length&&(d=c.shift());)!c.length&&a!==v?e[d]=a:e=e[d]?e[d]:e[d]={}};var C="undefined"!==typeof Uint8Array&&"undefined"!==typeof Uint16Array&&"undefined"!==typeof Uint32Array;function D(b,a){this.index="number"===typeof a?a:0;this.m=0;this.buffer=b instanceof(C?Uint8Array:Array)?b:new (C?Uint8Array:Array)(32768);2*this.buffer.length<=this.index&&n(Error("invalid index"));this.buffer.length<=this.index&&ba(this)}function ba(b){var a=b.buffer,c,e=a.length,d=new (C?Uint8Array:Array)(e<<1);if(C)d.set(a);else for(c=0;c<e;++c)d[c]=a[c];return b.buffer=d}
D.prototype.b=function(b,a,c){var e=this.buffer,d=this.index,g=this.m,h=e[d];c&&1<a&&(b=8<a?(E[b&255]<<24|E[b>>>8&255]<<16|E[b>>>16&255]<<8|E[b>>>24&255])>>32-a:E[b]>>8-a);if(8>a+g)h=h<<a|b,g+=a;else for(c=0;c<a;++c)h=h<<1|b>>a-c-1&1,8===++g&&(g=0,e[d++]=E[h],h=0,d===e.length&&(e=ba(this)));e[d]=h;this.buffer=e;this.m=g;this.index=d};D.prototype.finish=function(){var b=this.buffer,a=this.index;0<this.m&&(b[a]<<=8-this.m,b[a]=E[b[a]],a++);C?b=b.subarray(0,a):b.length=a;return b};
var ca=new (C?Uint8Array:Array)(256),F;for(F=0;256>F;++F){for(var G=F,H=G,da=7,G=G>>>1;G;G>>>=1)H<<=1,H|=G&1,--da;ca[F]=(H<<da&255)>>>0}var E=ca;function ea(b){var a=v,c,e="number"===typeof a?a:a=0,d=b.length;c=-1;for(e=d&7;e--;++a)c=c>>>8^I[(c^b[a])&255];for(e=d>>3;e--;a+=8)c=c>>>8^I[(c^b[a])&255],c=c>>>8^I[(c^b[a+1])&255],c=c>>>8^I[(c^b[a+2])&255],c=c>>>8^I[(c^b[a+3])&255],c=c>>>8^I[(c^b[a+4])&255],c=c>>>8^I[(c^b[a+5])&255],c=c>>>8^I[(c^b[a+6])&255],c=c>>>8^I[(c^b[a+7])&255];return(c^4294967295)>>>0}
var fa=[0,1996959894,3993919788,2567524794,124634137,1886057615,3915621685,2657392035,249268274,2044508324,3772115230,2547177864,162941995,2125561021,3887607047,2428444049,498536548,1789927666,4089016648,2227061214,450548861,1843258603,4107580753,2211677639,325883990,1684777152,4251122042,2321926636,335633487,1661365465,4195302755,2366115317,997073096,1281953886,3579855332,2724688242,1006888145,1258607687,3524101629,2768942443,901097722,1119000684,3686517206,2898065728,853044451,1172266101,3705015759,
2882616665,651767980,1373503546,3369554304,3218104598,565507253,1454621731,3485111705,3099436303,671266974,1594198024,3322730930,2970347812,795835527,1483230225,3244367275,3060149565,1994146192,31158534,2563907772,4023717930,1907459465,112637215,2680153253,3904427059,2013776290,251722036,2517215374,3775830040,2137656763,141376813,2439277719,3865271297,1802195444,476864866,2238001368,4066508878,1812370925,453092731,2181625025,4111451223,1706088902,314042704,2344532202,4240017532,1658658271,366619977,
2362670323,4224994405,1303535960,984961486,2747007092,3569037538,1256170817,1037604311,2765210733,3554079995,1131014506,879679996,2909243462,3663771856,1141124467,855842277,2852801631,3708648649,1342533948,654459306,3188396048,3373015174,1466479909,544179635,3110523913,3462522015,1591671054,702138776,2966460450,3352799412,1504918807,783551873,3082640443,3233442989,3988292384,2596254646,62317068,1957810842,3939845945,2647816111,81470997,1943803523,3814918930,2489596804,225274430,2053790376,3826175755,
2466906013,167816743,2097651377,4027552580,2265490386,503444072,1762050814,4150417245,2154129355,426522225,1852507879,4275313526,2312317920,282753626,1742555852,4189708143,2394877945,397917763,1622183637,3604390888,2714866558,953729732,1340076626,3518719985,2797360999,1068828381,1219638859,3624741850,2936675148,906185462,1090812512,3747672003,2825379669,829329135,1181335161,3412177804,3160834842,628085408,1382605366,3423369109,3138078467,570562233,1426400815,3317316542,2998733608,733239954,1555261956,
3268935591,3050360625,752459403,1541320221,2607071920,3965973030,1969922972,40735498,2617837225,3943577151,1913087877,83908371,2512341634,3803740692,2075208622,213261112,2463272603,3855990285,2094854071,198958881,2262029012,4057260610,1759359992,534414190,2176718541,4139329115,1873836001,414664567,2282248934,4279200368,1711684554,285281116,2405801727,4167216745,1634467795,376229701,2685067896,3608007406,1308918612,956543938,2808555105,3495958263,1231636301,1047427035,2932959818,3654703836,1088359270,
936918E3,2847714899,3736837829,1202900863,817233897,3183342108,3401237130,1404277552,615818150,3134207493,3453421203,1423857449,601450431,3009837614,3294710456,1567103746,711928724,3020668471,3272380065,1510334235,755167117],I=C?new Uint32Array(fa):fa;function J(b){this.buffer=new (C?Uint16Array:Array)(2*b);this.length=0}J.prototype.getParent=function(b){return 2*((b-2)/4|0)};J.prototype.push=function(b,a){var c,e,d=this.buffer,g;c=this.length;d[this.length++]=a;for(d[this.length++]=b;0<c;)if(e=this.getParent(c),d[c]>d[e])g=d[c],d[c]=d[e],d[e]=g,g=d[c+1],d[c+1]=d[e+1],d[e+1]=g,c=e;else break;return this.length};
J.prototype.pop=function(){var b,a,c=this.buffer,e,d,g;a=c[0];b=c[1];this.length-=2;c[0]=c[this.length];c[1]=c[this.length+1];for(g=0;;){d=2*g+2;if(d>=this.length)break;d+2<this.length&&c[d+2]>c[d]&&(d+=2);if(c[d]>c[g])e=c[g],c[g]=c[d],c[d]=e,e=c[g+1],c[g+1]=c[d+1],c[d+1]=e;else break;g=d}return{index:b,value:a,length:this.length}};function L(b){var a=b.length,c=0,e=Number.POSITIVE_INFINITY,d,g,h,f,k,l,r,p;for(r=0;r<a;++r)b[r]>c&&(c=b[r]),b[r]<e&&(e=b[r]);e=1<<c;d=new (C?Uint32Array:Array)(e);g=1;h=0;for(f=2;g<=c;){for(r=0;r<a;++r)if(b[r]===g){k=0;l=h;for(p=0;p<g;++p)k=k<<1|l&1,l>>=1;l=g<<16|r;for(p=k;p<e;p+=f)d[p]=l;++h}++g;h<<=1;f<<=1}};function ga(b,a){this.k=M;this.A=0;this.input=C&&b instanceof Array?new Uint8Array(b):b;this.d=0;if(a&&(a.lazy&&(this.A=a.lazy),"number"===typeof a.compressionType&&(this.k=a.compressionType),a.outputBuffer&&(this.a=C&&a.outputBuffer instanceof Array?new Uint8Array(a.outputBuffer):a.outputBuffer),"number"===typeof a.outputIndex))this.d=a.outputIndex;this.a||(this.a=new (C?Uint8Array:Array)(32768))}var M=2,ha={NONE:0,H:1,r:M,Y:3},N=[],O;
for(O=0;288>O;O++)switch(w){case 143>=O:N.push([O+48,8]);break;case 255>=O:N.push([O-144+400,9]);break;case 279>=O:N.push([O-256+0,7]);break;case 287>=O:N.push([O-280+192,8]);break;default:n("invalid literal: "+O)}
ga.prototype.o=function(){var b,a,c,e,d=this.input;switch(this.k){case 0:c=0;for(e=d.length;c<e;){a=C?d.subarray(c,c+65535):d.slice(c,c+65535);c+=a.length;var g=c===e,h=v,f=h=v,f=h=v,k=this.a,l=this.d;if(C){for(k=new Uint8Array(this.a.buffer);k.length<=l+a.length+5;)k=new Uint8Array(k.length<<1);k.set(this.a)}h=g?1:0;k[l++]=h|0;h=a.length;f=~h+65536&65535;k[l++]=h&255;k[l++]=h>>>8&255;k[l++]=f&255;k[l++]=f>>>8&255;if(C)k.set(a,l),l+=a.length,k=k.subarray(0,l);else{h=0;for(f=a.length;h<f;++h)k[l++]=
a[h];k.length=l}this.d=l;this.a=k}break;case 1:c=new D(C?new Uint8Array(this.a.buffer):this.a,this.d);c.b(1,1,w);c.b(1,2,w);d=ia(this,d);e=0;for(a=d.length;e<a;e++)if(g=d[e],D.prototype.b.apply(c,N[g]),256<g)c.b(d[++e],d[++e],w),c.b(d[++e],5),c.b(d[++e],d[++e],w);else if(256===g)break;this.a=c.finish();this.d=this.a.length;break;case M:c=new D(C?new Uint8Array(this.a.buffer):this.a,this.d);var r,p,t=[16,17,18,0,8,7,9,6,10,5,11,4,12,3,13,2,14,1,15],o,h=Array(19),j;a=M;c.b(1,1,w);c.b(a,2,w);d=ia(this,
d);k=ja(this.S,15);l=ka(k);a=ja(this.R,7);g=ka(a);for(f=286;257<f&&0===k[f-1];f--);for(r=30;1<r&&0===a[r-1];r--);var m=f,q=r;b=new (C?Uint32Array:Array)(m+q);var i=new (C?Uint32Array:Array)(316),s,u;o=new (C?Uint8Array:Array)(19);for(j=p=0;j<m;j++)b[p++]=k[j];for(j=0;j<q;j++)b[p++]=a[j];if(!C){j=0;for(q=o.length;j<q;++j)o[j]=0}j=s=0;for(q=b.length;j<q;j+=p){for(p=1;j+p<q&&b[j+p]===b[j];++p);m=p;if(0===b[j])if(3>m)for(;0<m--;)i[s++]=0,o[0]++;else for(;0<m;)u=138>m?m:138,u>m-3&&u<m&&(u=m-3),10>=u?(i[s++]=
17,i[s++]=u-3,o[17]++):(i[s++]=18,i[s++]=u-11,o[18]++),m-=u;else if(i[s++]=b[j],o[b[j]]++,m--,3>m)for(;0<m--;)i[s++]=b[j],o[b[j]]++;else for(;0<m;)u=6>m?m:6,u>m-3&&u<m&&(u=m-3),i[s++]=16,i[s++]=u-3,o[16]++,m-=u}b=C?i.subarray(0,s):i.slice(0,s);o=ja(o,7);for(j=0;19>j;j++)h[j]=o[t[j]];for(p=19;4<p&&0===h[p-1];p--);t=ka(o);c.b(f-257,5,w);c.b(r-1,5,w);c.b(p-4,4,w);for(j=0;j<p;j++)c.b(h[j],3,w);j=0;for(f=b.length;j<f;j++)if(h=b[j],c.b(t[h],o[h],w),16<=h){j++;switch(h){case 16:e=2;break;case 17:e=3;break;
case 18:e=7;break;default:n("invalid code: "+h)}c.b(b[j],e,w)}k=[l,k];l=[g,a];e=k[0];a=k[1];g=l[0];h=l[1];k=0;for(l=d.length;k<l;++k)if(f=d[k],c.b(e[f],a[f],w),256<f)c.b(d[++k],d[++k],w),f=d[++k],c.b(g[f],h[f],w),c.b(d[++k],d[++k],w);else if(256===f)break;this.a=c.finish();this.d=this.a.length;break;default:n("invalid compression type")}return this.a};function la(b,a){this.length=b;this.I=a}
function ma(){var b=P;switch(w){case 3===b:return[257,b-3,0];case 4===b:return[258,b-4,0];case 5===b:return[259,b-5,0];case 6===b:return[260,b-6,0];case 7===b:return[261,b-7,0];case 8===b:return[262,b-8,0];case 9===b:return[263,b-9,0];case 10===b:return[264,b-10,0];case 12>=b:return[265,b-11,1];case 14>=b:return[266,b-13,1];case 16>=b:return[267,b-15,1];case 18>=b:return[268,b-17,1];case 22>=b:return[269,b-19,2];case 26>=b:return[270,b-23,2];case 30>=b:return[271,b-27,2];case 34>=b:return[272,b-31,
2];case 42>=b:return[273,b-35,3];case 50>=b:return[274,b-43,3];case 58>=b:return[275,b-51,3];case 66>=b:return[276,b-59,3];case 82>=b:return[277,b-67,4];case 98>=b:return[278,b-83,4];case 114>=b:return[279,b-99,4];case 130>=b:return[280,b-115,4];case 162>=b:return[281,b-131,5];case 194>=b:return[282,b-163,5];case 226>=b:return[283,b-195,5];case 257>=b:return[284,b-227,5];case 258===b:return[285,b-258,0];default:n("invalid length: "+b)}}var na=[],P,Q;
for(P=3;258>=P;P++)Q=ma(),na[P]=Q[2]<<24|Q[1]<<16|Q[0];var oa=C?new Uint32Array(na):na;
function ia(b,a){function c(b,c){var a=b.I,d=[],e=0,g;g=oa[b.length];d[e++]=g&65535;d[e++]=g>>16&255;d[e++]=g>>24;var f;switch(w){case 1===a:f=[0,a-1,0];break;case 2===a:f=[1,a-2,0];break;case 3===a:f=[2,a-3,0];break;case 4===a:f=[3,a-4,0];break;case 6>=a:f=[4,a-5,1];break;case 8>=a:f=[5,a-7,1];break;case 12>=a:f=[6,a-9,2];break;case 16>=a:f=[7,a-13,2];break;case 24>=a:f=[8,a-17,3];break;case 32>=a:f=[9,a-25,3];break;case 48>=a:f=[10,a-33,4];break;case 64>=a:f=[11,a-49,4];break;case 96>=a:f=[12,a-
65,5];break;case 128>=a:f=[13,a-97,5];break;case 192>=a:f=[14,a-129,6];break;case 256>=a:f=[15,a-193,6];break;case 384>=a:f=[16,a-257,7];break;case 512>=a:f=[17,a-385,7];break;case 768>=a:f=[18,a-513,8];break;case 1024>=a:f=[19,a-769,8];break;case 1536>=a:f=[20,a-1025,9];break;case 2048>=a:f=[21,a-1537,9];break;case 3072>=a:f=[22,a-2049,10];break;case 4096>=a:f=[23,a-3073,10];break;case 6144>=a:f=[24,a-4097,11];break;case 8192>=a:f=[25,a-6145,11];break;case 12288>=a:f=[26,a-8193,12];break;case 16384>=
a:f=[27,a-12289,12];break;case 24576>=a:f=[28,a-16385,13];break;case 32768>=a:f=[29,a-24577,13];break;default:n("invalid distance")}g=f;d[e++]=g[0];d[e++]=g[1];d[e++]=g[2];a=0;for(e=d.length;a<e;++a)r[p++]=d[a];o[d[0]]++;j[d[3]]++;t=b.length+c-1;l=null}var e,d,g,h,f,k={},l,r=C?new Uint16Array(2*a.length):[],p=0,t=0,o=new (C?Uint32Array:Array)(286),j=new (C?Uint32Array:Array)(30),m=b.A;if(!C){for(g=0;285>=g;)o[g++]=0;for(g=0;29>=g;)j[g++]=0}o[256]=1;e=0;for(d=a.length;e<d;++e){g=f=0;for(h=3;g<h&&e+
g!==d;++g)f=f<<8|a[e+g];k[f]===v&&(k[f]=[]);g=k[f];if(!(0<t--)){for(;0<g.length&&32768<e-g[0];)g.shift();if(e+3>=d){l&&c(l,-1);g=0;for(h=d-e;g<h;++g)f=a[e+g],r[p++]=f,++o[f];break}if(0<g.length){h=f=v;var q=0,i=v,s=v,u=i=v,K=a.length,s=0,u=g.length;a:for(;s<u;s++){f=g[u-s-1];i=3;if(3<q){for(i=q;3<i;i--)if(a[f+i-1]!==a[e+i-1])continue a;i=q}for(;258>i&&e+i<K&&a[f+i]===a[e+i];)++i;i>q&&(h=f,q=i);if(258===i)break}h=new la(q,e-h);l?l.length<h.length?(f=a[e-1],r[p++]=f,++o[f],c(h,0)):c(l,-1):h.length<
m?l=h:c(h,0)}else l?c(l,-1):(f=a[e],r[p++]=f,++o[f])}g.push(e)}r[p++]=256;o[256]++;b.S=o;b.R=j;return C?r.subarray(0,p):r}
function ja(b,a){function c(a){var b=p[a][t[a]];b===l?(c(a+1),c(a+1)):--r[b];++t[a]}var e=b.length,d=new J(572),g=new (C?Uint8Array:Array)(e),h,f,k;if(!C)for(f=0;f<e;f++)g[f]=0;for(f=0;f<e;++f)0<b[f]&&d.push(f,b[f]);e=Array(d.length/2);h=new (C?Uint32Array:Array)(d.length/2);if(1===e.length)return g[d.pop().index]=1,g;f=0;for(k=d.length/2;f<k;++f)e[f]=d.pop(),h[f]=e[f].value;var l=h.length;f=new (C?Uint16Array:Array)(a);var d=new (C?Uint8Array:Array)(a),r=new (C?Uint8Array:Array)(l);k=Array(a);var p=
Array(a),t=Array(a),o=(1<<a)-l,j=1<<a-1,m,q,i;f[a-1]=l;for(m=0;m<a;++m)o<j?d[m]=0:(d[m]=1,o-=j),o<<=1,f[a-2-m]=(f[a-1-m]/2|0)+l;f[0]=d[0];k[0]=Array(f[0]);p[0]=Array(f[0]);for(m=1;m<a;++m)f[m]>2*f[m-1]+d[m]&&(f[m]=2*f[m-1]+d[m]),k[m]=Array(f[m]),p[m]=Array(f[m]);for(o=0;o<l;++o)r[o]=a;for(j=0;j<f[a-1];++j)k[a-1][j]=h[j],p[a-1][j]=j;for(o=0;o<a;++o)t[o]=0;1===d[a-1]&&(--r[0],++t[a-1]);for(m=a-2;0<=m;--m){q=o=0;i=t[m+1];for(j=0;j<f[m];j++)q=k[m+1][i]+k[m+1][i+1],q>h[o]?(k[m][j]=q,p[m][j]=l,i+=2):(k[m][j]=
h[o],p[m][j]=o,++o);t[m]=0;1===d[m]&&c(m)}h=r;f=0;for(k=e.length;f<k;++f)g[e[f].index]=h[f];return g}function ka(b){var a=new (C?Uint16Array:Array)(b.length),c=[],e=[],d=0,g,h,f;g=0;for(h=b.length;g<h;g++)c[b[g]]=(c[b[g]]|0)+1;g=1;for(h=16;g<=h;g++)e[g]=d,d+=c[g]|0,d<<=1;g=0;for(h=b.length;g<h;g++){d=e[b[g]];e[b[g]]+=1;c=a[g]=0;for(f=b[g];c<f;c++)a[g]=a[g]<<1|d&1,d>>>=1}return a};var pa=[16,17,18,0,8,7,9,6,10,5,11,4,12,3,13,2,14,1,15];C&&new Uint16Array(pa);var qa=[3,4,5,6,7,8,9,10,11,13,15,17,19,23,27,31,35,43,51,59,67,83,99,115,131,163,195,227,258,258,258];C&&new Uint16Array(qa);var ra=[0,0,0,0,0,0,0,0,1,1,1,1,2,2,2,2,3,3,3,3,4,4,4,4,5,5,5,5,0,0,0];C&&new Uint8Array(ra);var sa=[1,2,3,4,5,7,9,13,17,25,33,49,65,97,129,193,257,385,513,769,1025,1537,2049,3073,4097,6145,8193,12289,16385,24577];C&&new Uint16Array(sa);
var ta=[0,0,0,0,1,1,2,2,3,3,4,4,5,5,6,6,7,7,8,8,9,9,10,10,11,11,12,12,13,13];C&&new Uint8Array(ta);var ua=new (C?Uint8Array:Array)(288),R,va;R=0;for(va=ua.length;R<va;++R)ua[R]=143>=R?8:255>=R?9:279>=R?7:8;L(ua);var wa=new (C?Uint8Array:Array)(30),S,xa;S=0;for(xa=wa.length;S<xa;++S)wa[S]=5;L(wa);var ya=[16,17,18,0,8,7,9,6,10,5,11,4,12,3,13,2,14,1,15];C&&new Uint16Array(ya);var za=[3,4,5,6,7,8,9,10,11,13,15,17,19,23,27,31,35,43,51,59,67,83,99,115,131,163,195,227,258,258,258];C&&new Uint16Array(za);var Aa=[0,0,0,0,0,0,0,0,1,1,1,1,2,2,2,2,3,3,3,3,4,4,4,4,5,5,5,5,0,0,0];C&&new Uint8Array(Aa);var Ba=[1,2,3,4,5,7,9,13,17,25,33,49,65,97,129,193,257,385,513,769,1025,1537,2049,3073,4097,6145,8193,12289,16385,24577];C&&new Uint16Array(Ba);
var Ca=[0,0,0,0,1,1,2,2,3,3,4,4,5,5,6,6,7,7,8,8,9,9,10,10,11,11,12,12,13,13];C&&new Uint8Array(Ca);var Da=new (C?Uint8Array:Array)(288),T,Ea;T=0;for(Ea=Da.length;T<Ea;++T)Da[T]=143>=T?8:255>=T?9:279>=T?7:8;L(Da);var Fa=new (C?Uint8Array:Array)(30),U,Ga;U=0;for(Ga=Fa.length;U<Ga;++U)Fa[U]=5;L(Fa);function Ha(b,a){this.input=b;this.a=new (C?Uint8Array:Array)(32768);this.k=Ia.r;var c={},e;if((a||!(a={}))&&"number"===typeof a.compressionType)this.k=a.compressionType;for(e in a)c[e]=a[e];c.outputBuffer=this.a;this.D=new ga(this.input,c)}var Ia=ha;
Ha.prototype.o=function(){var b,a,c,e=0;c=this.a;switch(8){case 8:b=Math.LOG2E*Math.log(32768)-8;break;default:n(Error("invalid compression method"))}b=b<<4|8;c[e++]=b;switch(8){case 8:switch(this.k){case Ia.NONE:a=0;break;case Ia.H:a=1;break;case Ia.r:a=2;break;default:n(Error("unsupported compression type"))}break;default:n(Error("invalid compression method"))}a=a<<6|0;c[e++]=a|31-(256*b+a)%31;c=this.input;if("string"===typeof c){c=c.split("");b=0;for(a=c.length;b<a;b++)c[b]=(c[b].charCodeAt(0)&
255)>>>0}b=1;a=0;for(var d=c.length,g,h=0;0<d;){g=1024<d?1024:d;d-=g;do b+=c[h++],a+=b;while(--g);b%=65521;a%=65521}b=(a<<16|b)>>>0;this.D.d=e;c=this.D.o();e=c.length;C&&(c=new Uint8Array(c.buffer),c.length<=e+4&&(this.a=new Uint8Array(c.length+4),this.a.set(c),c=this.a),c=c.subarray(0,e+4));c[e++]=b>>24&255;c[e++]=b>>16&255;c[e++]=b>>8&255;c[e++]=b&255;return c};function Ja(b,a){var c,e;b instanceof Object?(c={},c.t=b.PLTE,c.F=b.tRNS,c.s=b.IDAT,this.T=c,c=a.width,e=a.height):n(Error("invalid arguments"));var d=a;"object"!==typeof d&&(d={});this.width=c;this.height=e;this.c="number"===typeof d.bitDepth?d.bitDepth:8;this.i="number"===typeof d.colourType?d.colourType:V;this.u="number"===typeof d.compressionMethod?d.compressionMethod:Ka;this.p="number"===typeof d.filterMethod?d.filterMethod:La;this.w="number"===typeof d.filterType?d.filterType:Ma;this.z="number"===
typeof d.interlaceMethod?d.interlaceMethod:Na;this.G=w;this.K=d.deflateOption;this.l=null;this.n=[];this.B=[];var g,d=!1;switch(this.i){case 0:g=[1,2,4,8,16];break;case 3:g=[1,2,4,8];break;case 2:case 4:case V:g=[8,16];break;default:n(Error("invalid colour type"))}c=0;for(e=g.length;c<e;c++)if(this.c===g[c]){d=w;break}!1===d&&n(Error("invalid parameter"))}
var Oa=W("IHDR"),Pa=W("PLTE"),Qa=W("IDAT"),Ra=W("IEND"),Sa=W("tRNS"),Ka=0,V=6,La=0,Ma=0,Na=0,Ta=[137,80,78,71,13,10,26,10],Ua=[{e:0,g:0,f:8,h:8},{e:4,g:0,f:8,h:8},{e:0,g:4,f:4,h:8},{e:2,g:0,f:4,h:4},{e:0,g:2,f:2,h:4},{e:1,g:0,f:2,h:2},{e:0,g:1,f:1,h:2}];z=Ja.prototype;z.J=function(){for(var b=this.v(),a=[],c=0,e=b.length;c<e;c++)a[c]=String.fromCharCode(b[c]);return a.join("")};
z.v=function(){var b,a;if(!(a=this.T)){a=this.data;b=[];var c=this.G,e=this.c,d=[],g=[],h={},f={},k=[],l=0,r=0,p=0,t=0,o={},j=0,m=0,q,i,s;i=0;for(s=a.length;i<s;i+=4)q=c?X(a,i,4).map(this.q).join(""):Va(this,X(a,i,3)),h[q]=(h[q]|0)+1,l=a[i],r=a[i+1],p=a[i+2],t=a[i+3],j=((l<<8|r)<<8|p)<<8|t,o[j]===v&&(m=this.n.length,this.n.push({red:l,green:r,blue:p,alpha:t,count:0}),o[j]=m),this.n[o[j]].count++;l=0<(this.i&4);switch(this.i){case 4:case 0:i=0;for(s=a.length;i<s;i+=4)q=this.X.apply(this,X(a,i,3)),
t=a[i+3],8>e&&(q>>>=8-e,t>>>=8-e),q=[q],l&&q.push(t),b.push(q);break;case 2:case V:i=0;for(s=a.length;i<s;i+=4)q=X(a,i,l?4:3),b.push(q);break;case 3:for(q in h)k.push(q);c&&k.sort(function(a,b){return a.charCodeAt(3)<b.charCodeAt(3)?-1:a.charCodeAt(3)>b.charCodeAt(3)?1:a.charCodeAt(0)<b.charCodeAt(0)?-1:a.charCodeAt(0)>b.charCodeAt(0)?1:a.charCodeAt(1)<b.charCodeAt(1)?-1:a.charCodeAt(1)>b.charCodeAt(1)?1:a.charCodeAt(2)<b.charCodeAt(2)?-1:a.charCodeAt(2)>b.charCodeAt(2)?1:0});i=0;for(s=k.length;i<
s;i++)q=k[i],c?(255!==q.charCodeAt(3)&&(g[i]=q.charCodeAt(3)),f[q]=i):f[q.slice(0,3)]=i,d.push(q.charCodeAt(0)),d.push(q.charCodeAt(1)),d.push(q.charCodeAt(2));this.j instanceof Array&&(3!==this.j.length&&n(Error("wrong background-color length")),Va(this,this.j)in h||(d.length/3===1<<this.c&&n(Error("can not add background-color to palette")),d.push(this.j[0]),d.push(this.j[1]),d.push(this.j[2])));d.length/3>1<<this.c&&n(Error("over "+(1<<this.c)+" colors: "+d.length/3));i=0;for(s=d.length/3;i<s;i++)this.B[i]=
0;i=0;for(s=a.length;i<s;i+=4)q=c?X(a,i,4).map(this.q).join(""):Va(this,X(a,i,3)),this.B[f[q]]++,b.push([f[q]]);break;default:n(Error("invalid colour type"))}a={t:d,F:g,s:b}}b=a;a=new Uint8Array(13);d=new DataView(a.buffer);d.setUint32(0,this.width);d.setUint32(4,this.height);a[8]=this.c;a[9]=this.i;a[10]=this.u;a[11]=this.p;a[12]=this.z;a=Y(Oa,a);var u,K;switch(this.i){case 3:u=b.t;256<u.length/3&&n(Error("over 256 colors: "+u.length/3));u=Y(Pa,u);this.G&&(K=Y(Sa,b.F));break;default:n(Error("Unsupported colour type"))}var x;
b=b.s;d=new Uint8Array(b.length+this.height);g=this.p;q=this.w;var A,y;switch(this.z){case Na:A=this.V;break;case 1:A=this.U;break;default:n(Error("unknown interlace method"))}this.W=A;switch(this.p){case La:switch(this.w){case Ma:y=this.M;break;case 1:y=this.O;break;case 2:y=this.P;break;case 3:y=this.L;break;case 4:y=this.N;break;default:n(Error("unknown filter type"))}break;default:n(Error("unknown filter method"))}this.Q=y;A=0<(this.i&4);switch(this.i){case 3:x=1;break;case 0:case 4:x=1;A&&(x+=
1);16===this.c&&(x*=2);break;case 2:case V:x=3;A&&(x+=1);16===this.c&&(x*=2);break;default:n(Error("unknown colour type"))}y=x;i=this.W(b);s=0;for(c=i.length;s<c;s++)if(e=i[s],b=e.C,0!==b.length){x=e.width;this.l=null;A=0;for(e=e.height;A<e;A++){h=X(b,A*x,x);switch(g){case La:d[A*(x+1)]=q;d.set(this.Q(h,y),A*(x+1)+1);break;default:n(Error("unknown filter method"))}this.l=h}}switch(this.u){case Ka:d=(new Ha(d,this.K)).o();break;default:n(Error("unknown compression method"))}x=Y(Qa,d);A=Y(Ra,new Uint8Array(0));
y=new Uint8Array(Ta.length+a.length+u.length+K.length+x.length+A.length);b=0;y.set(Ta);b+=Ta.length;y.set(a,b);b+=a.length;y.set(u,b);b+=u.length;y.set(K,b);b+=K.length;y.set(x,b);b+=x.length;y.set(A,b);return y};function Z(b,a,c){this.width=b;this.height=a;this.C=c}z.V=function(b){return[new Z(this.width,this.height,b)]};
z.U=function(b){var a=this.height,c=b.length/a,e,d,g,h,f,k,l,r,p,t,o,j;o=[new Z(0,0,[]),new Z(0,0,[]),new Z(0,0,[]),new Z(0,0,[]),new Z(0,0,[]),new Z(0,0,[]),new Z(0,0,[])];r=0;for(p=Ua.length;r<p;r++){j=o[r];t=Ua[r];for(d=f=k=0;d<a;d+=8)for(h=t.g;8>h;h+=t.h)for(e=0;e<c;e+=8)for(g=t.e;8>g;g+=t.f)if(l=b[e+g+(d+h)*c])f=(e+g-t.e)/t.f,k=(d+h-t.g)/t.h,j.C.push(l);j.width=f+1;j.height=k+1}return o};z.M=function(b){return b};
z.O=function(b,a){var c=[],e=0,d,g;d=0;for(g=b.length;d<g;d++)e=b[d-a]||0,c.push(b[d]-e+256&255);return c};z.P=function(b){var a=[],c,e=this.l,d,g;d=0;for(g=b.length;d<g;d++)c=e&&e[d]?e[d]:0,a.push(b[d]-c+256&255);return a};z.L=function(b,a){var c=[],e,d,g=this.l,h,f;h=0;for(f=b.length;h<f;h++)e=b[h-a]||0,d=g&&g[h]||0,e=e+d>>>1,c.push(b[h]+256-e&255);return c};
z.N=function(b,a){var c=[],e,d,g,h=this.l,f,k;f=0;for(k=b.length;f<k;f++){e=b[f-a]||0;d=h&&h[f]||0;g=h&&h[f-a]||0;var l=v,r=v,p=v,l=v,l=e+d-g,r=Math.abs(l-e),p=Math.abs(l-d),l=Math.abs(l-g);e=r<=p&&r<=l?e:p<=l?d:g;c.push(b[f]-e+256&255)}return c};function X(b,a,c){return"function"===typeof b.slice?b.slice(a,a+c):Array.prototype.slice.call(b,a,a+c)}
function Y(b,a){var c=new Uint8Array(a.length+12),e=a.length,d=new DataView(c.buffer);d.setUint32(0,e);c.set(b,4);c.set(a,8);d.setUint32(8+a.length,ea(c.subarray(4,8+a.length)));return c}z.X=function(b,a,c){b=0.29891*b+0.58661*a+0.11448*c+1.0E-4;return(255<b?255:b)|0};function Va(b,a){return a.slice(0,3).map(b.q).join("")}z.q=function(b){return String.fromCharCode(b).charAt(0)};function W(b){var b=b.split(""),a=[],c,e;c=0;for(e=b.length;c<e;c++)a[c]=b[c].charCodeAt(0);return a}
function $(b,a){for(var c in a)B([b,c].join("."),a[c])}B("CanvasTool.PngEncoder",Ja);$("CanvasTool.PngEncoder.CompressionMethod",{DEFLATE:Ka});$("CanvasTool.PngEncoder.ColourType",{GRAYSCALE:0,TRUECOLOR:2,INDEXED_COLOR:3,GRAYSCALE_WITH_ALPHA:4,TRUECOLOR_WITH_ALPHA:V});$("CanvasTool.PngEncoder.FilterMethod",{BASIC:La});$("CanvasTool.PngEncoder.BasicFilterType",{NONE:Ma,SUB:1,UP:2,AVERAGE:3,PAETH:4});$("CanvasTool.PngEncoder.InterlaceMethod",{NONE:Na,ADAM7:1});
B("CanvasTool.PngEncoder.prototype.convert",Ja.prototype.J);B("CanvasTool.PngEncoder.prototype.convertToArray",Ja.prototype.v);}).call(this);
